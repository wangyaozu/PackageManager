<Page x:Class="PackageManager.Views.SettingsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:button="clr-namespace:CustomControlLibrary.CustomControl.Controls.Button;assembly=CustomControlLibrary"
             xmlns:controls="clr-namespace:CustomControlLibrary.CustomControl.Controls;assembly=CustomControlLibrary"
             mc:Ignorable="d">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 统一面包屑 + 页标题 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="应用程序设置" FontSize="20" FontWeight="Bold"/>
        </StackPanel>

        <!-- 设置内容 -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>

                <!-- Addin路径设置 -->
                <GroupBox Header="Addin文件夹设置" Margin="0,0,0,20">

                    <StackPanel Margin="10">
                        <TextBlock Text="默认Addin文件夹路径：" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBlock Text="如默认addin文件夹与实际不符，请输入指定路径" 
                                   Foreground="Gray" FontSize="12" Margin="0,0,0,10"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox x:Name="AddinPathTextBox" Grid.Column="0" Height="30"
                                     Text="{Binding AddinPath, UpdateSourceTrigger=PropertyChanged}"
                                     Margin="0,0,10,0" Padding="5"/>
                            <button:CButton x:Name="BrowseButton" Grid.Column="1" Content="浏览..."  Height="30"
                                    Padding="10,5" Click="BrowseButton_Click"/>
                        </Grid>

                        <TextBlock Text="默认路径：C:\\ProgramData\\Autodesk\\Revit\\Addins" 
                                   Foreground="Gray" FontSize="11" Margin="0,5,0,0"/>

                        <CheckBox Content="程序入口文件是否带G" IsChecked="{Binding ProgramEntryWithG, UpdateSourceTrigger=PropertyChanged}"
                                  VerticalAlignment="Center" VerticalContentAlignment="Center" Margin="0,15,0,0"></CheckBox>
                    </StackPanel>
                </GroupBox>

                <!-- 日志设置 -->
                <GroupBox Header="日志设置" Margin="0,0,0,20">
                    <StackPanel Margin="10" Orientation="Horizontal">
                        <controls:CTextBlock Text="日志查看工具:" VerticalAlignment="Center"/>
                        <controls:CComboBox ItemsSource="{Binding LogTxtReaders}"
                                            SelectedValue="{Binding LogTxtReader}"
                                            Width="280"/>
                    </StackPanel>
                </GroupBox>

                <!-- 更新服务器地址设置 -->
                <GroupBox Header="更新服务器地址" Margin="0,0,0,20">
                    <StackPanel Margin="10">
                        <TextBlock Text="用于应用自动更新的服务器根路径" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBlock Text="示例：http://server:port/PackageManager/ 或 ftp://server/PackageManager/" 
                                   Foreground="Gray" FontSize="12" Margin="0,0,0,10"/>
                        <TextBox x:Name="UpdateServerUrlTextBox" Text="{Binding UpdateServerUrl, UpdateSourceTrigger=PropertyChanged}" 
                                 Padding="5"/>
                        <TextBlock Text="留空则使用环境变量或内置回退地址" 
                                   Foreground="Gray" FontSize="11" Margin="0,5,0,0"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="目录过滤" Margin="0,0,0,20">
                    <StackPanel Margin="10">
                        <CheckBox Content="拉取版本目录时过滤含 log 的目录" IsChecked="{Binding FilterLogDirectories, UpdateSourceTrigger=PropertyChanged}"/>
                        <TextBlock Text="默认启用，过滤如 v11.3.2.0_log 等目录" Foreground="Gray" FontSize="11" Margin="0,5,0,0"/>
                    </StackPanel>
                </GroupBox>

                <!-- 已使用Page显示，此处不再使用 -->
                <GroupBox Header="包配置" Margin="0,0,0,20" Visibility="Collapsed">
                    <StackPanel Margin="10">
                        <TextBlock Text="管理包配置（内置不可修改，自定义可新增/删除）" FontWeight="Bold" Margin="0,0,0,5"/>
                        <StackPanel Orientation="Horizontal">
                            <Button Content="包配置管理" Padding="10,5" Click="OpenPackagesConfigButton_Click"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>
                
                <!-- 数据管理 -->
                <GroupBox Header="数据管理" Margin="0,0,0,20">
                    <StackPanel Margin="10">
                        <TextBlock Text="清除应用程序数据：" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBlock Text="清除所有保存的配置、缓存和状态数据" 
                                   Foreground="Gray" FontSize="12" Margin="0,0,0,10"/>
                        
                        <StackPanel Orientation="Horizontal">
                            <button:CButton x:Name="ClearCacheButton" Content="清除缓存数据" 
                                     Padding="10,5" Margin="0,0,10,0" Click="ClearCacheButton_Click"/>
                            <button:CButton x:Name="ClearStateButton" Content="清除状态数据" 
                                     Padding="10,5" Margin="0,0,10,0" Click="ClearStateButton_Click"/>
                            <button:CDangerButton x:Name="ClearAllButton" Content="清除所有数据" 
                                    Padding="10,5" Background="#FFE74C3C" Foreground="White" 
                                    Click="ClearAllButton_Click"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>
                
                <!-- 应用信息 -->
                <GroupBox Header="应用信息">
                    <StackPanel Margin="10">
                        <TextBlock Text="{Binding AppVersionText}" Margin="0,0,0,5"/>
                        <TextBlock Text="数据存储位置：" FontWeight="Bold" Margin="0,10,0,5"/>
                        <TextBlock x:Name="DataLocationTextBlock" Text="{Binding DataLocation}" 
                                   Foreground="Gray" FontSize="11" TextWrapping="Wrap"/>

                        <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                            <button:CButton x:Name="UpgradeToLatestButton" Content="升级到最新" Padding="12,6" Click="UpgradeToLatestButton_Click"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>
        
        <!-- 按钮栏 -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <button:CButton x:Name="ResetButton" Content="重置为默认" Padding="10,5" 
                    Margin="0,0,10,0" Click="ResetButton_Click"/>
            <button:CButton x:Name="SaveButton" Content="保存" Padding="15,5" 
                     Margin="0,0,10,0" Click="SaveButton_Click"/>
            <button:CButton x:Name="CancelButton" Content="取消" Padding="15,5" 
                     Click="CancelButton_Click"/>
        </StackPanel>
    </Grid>
</Page>
